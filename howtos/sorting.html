

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Sorting &mdash; Getting Started with Xapian 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Getting Started with Xapian 0.1 documentation" href="../index.html" />
    <link rel="up" title="How To..." href="index.html" />
    <link rel="next" title="Collapsing of Search Results" href="collapsing.html" />
    <link rel="prev" title="Facets" href="facets.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="collapsing.html" title="Collapsing of Search Results"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="facets.html" title="Facets"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Getting Started with Xapian 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">How To...</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="sorting">
<h1>Sorting<a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h1>
<p>By default, Xapian orders search results by decreasing relevance score.
However, it also allows results to be ordered by other criteria, or
a combination of other criteria and relevance score.</p>
<p>If two or more results compare equal by the sorting criteria, then their
order is decided by their document ids.  By default, the document ids sort
in ascending order (so a lower document id is &#8220;better&#8221;), but descending
order can be chosen using <tt class="docutils literal"><span class="pre">#x_enquire.docid_order</span> <span class="pre">=</span> <span class="pre">desc</span></tt>.
If you have no preference, you can tell Xapian to use whatever order is
most efficient using <tt class="docutils literal"><span class="pre">#x_enquire.docid_order</span> <span class="pre">=</span> <span class="pre">dont_care</span></tt>.
It is also possible to change the way that the relevance scores are calculated
- for details, see the :ref:<a href="#id1"><span class="problematic" id="id2">`</span></a>document on weighting schemes and</p>
<blockquote>
<div>document scoring &lt;weighting_scheme&gt;` for details.</div></blockquote>
<div class="section" id="sorting-by-value">
<h2>Sorting by Value<a class="headerlink" href="#sorting-by-value" title="Permalink to this headline">¶</a></h2>
<p>You can order documents by comparing a specified document value.  Note that the
comparison used compares the byte values in the value (i.e. it&#8217;s a string sort
ignoring locale), so <tt class="docutils literal"><span class="pre">1</span></tt> &lt; <tt class="docutils literal"><span class="pre">10</span></tt> &lt; <tt class="docutils literal"><span class="pre">2</span></tt>.  If you want to encode the value
such that it sorts numerically, use a typed value slot. For example, for slot
with name &#8220;price&#8221;, use:</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nv">Price</span> <span class="o">=</span> <span class="mi">600</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span>
<span class="c">%% Pass #x_value_name as a parameter</span>
<span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Server</span><span class="p">}</span> <span class="o">=</span> <span class="nn">xapian_server</span><span class="p">:</span><span class="n">open</span><span class="p">(</span><span class="nv">Path</span><span class="p">,</span>
    <span class="p">[</span><span class="nl">#x_value_name</span><span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="n">price</span><span class="p">,</span> <span class="n">slot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">}|</span><span class="nv">Params</span><span class="p">]),</span>
<span class="c">%% Use a named slot. Pass Price as a float.</span>
<span class="nv">Doc</span> <span class="o">=</span> <span class="p">[</span> <span class="nl">#x_value</span><span class="p">{</span><span class="n">slot</span> <span class="o">=</span> <span class="n">price</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="nv">Price</span><span class="p">}</span> <span class="p">],</span>
<span class="nn">xapian_server</span><span class="p">:</span><span class="n">add_document</span><span class="p">(</span><span class="nv">Server</span><span class="p">,</span> <span class="nv">Doc</span><span class="p">).</span>
</pre></div>
</div>
<p>You can sort by value with the next code:</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nl">#x_enquire</span><span class="p">{</span><span class="n">order</span> <span class="o">=</span> <span class="nl">#x_sort_order</span><span class="p">{</span><span class="n">type</span> <span class="o">=</span> <span class="nv">Type</span><span class="p">,</span> <span class="n">slot</span> <span class="o">=</span> <span class="nv">Slot</span><span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">#x_sort_order.type</span></tt> field defines the order algorithm. The valid values
are:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">value</span></tt> specifies the relevance doesn&#8217;t affect the
ordering at all.</li>
<li><tt class="docutils literal"><span class="pre">value_relevance</span></tt> specifies that relevance is
used for ordering any groups of documents for which the value is the same.</li>
<li><tt class="docutils literal"><span class="pre">relevance_value</span></tt> specifies that documents are
ordered by relevance, and the value is only used to order groups of documents
with identical relevance values (note: the weight has to be exactly the same
for values to determine the order, so this method isn&#8217;t very useful when
using BM25 with the default parameters, as that will rarely give identical
scores to different documents).</li>
</ul>
</div></blockquote>
<p>We&#8217;ll use the states dataset to demonstrate this, and the code from
dealing with dates in the <em class="xref std std-ref">range queries</em> HOWTO:</p>
<div class="highlight-python"><pre>$ ./bin/index_ranges2.escript priv/states.csv priv/test_db/ranges2</pre>
</div>
<p>This has three document values: slot 1 has the year of admission to
the union, slot 2 the full date (as &#8220;YYYYMMDD&#8221;), and slot 3 the latest
population estimate. So if we want to sort by year of entry to the
union and then within that by relevance, we want to add the following:</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nl">#x_enquire</span><span class="p">{</span><span class="n">value</span> <span class="o">=</span> <span class="nv">Query</span><span class="p">,</span>
           <span class="n">order</span> <span class="o">=</span> <span class="nl">#x_sort_order</span><span class="p">{</span><span class="n">type</span> <span class="o">=</span> <span class="n">value_relevance</span><span class="p">,</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">admitted_year</span><span class="p">}}.</span>
</pre></div>
</div>
<p>The <cite>#x_sort_order.reverse</cite> parameter is <cite>False</cite> for ascending order,
<cite>True</cite> for descending. We can then run sorted searches like this:</p>
<div class="highlight-python"><pre>$ ./bin/search_sorting.escript priv/test_db/ranges spanish
1: #019            State of Texas       18451229          25145561
2: #004          State of Montana       18891108            989415</pre>
</div>
</div>
<div class="section" id="generated-sort-keys">
<h2>Generated Sort Keys<a class="headerlink" href="#generated-sort-keys" title="Permalink to this headline">¶</a></h2>
<p>To allow more elaborate sorting schemes, Xapian allows you to provide a
functor object subclassed from <tt class="docutils literal"><span class="pre">Xapian::KeyMaker</span></tt> which generates a sort
key for each matching document which is under consideration.  This is
called at most once for each document, and then the generated sort keys are
ordered by comparing byte values (i.e. with a string sort ignoring locale).</p>
<div class="section" id="sorting-by-multiple-values">
<h3>Sorting by Multiple Values<a class="headerlink" href="#sorting-by-multiple-values" title="Permalink to this headline">¶</a></h3>
<p>The call of the <tt class="docutils literal"><span class="pre">xapian_resource:multi_value_key_maker</span></tt> function returns a
resource of the standard class <tt class="docutils literal"><span class="pre">Xapian::MultiValueKeyMaker</span></tt>.
This allows to sort on more than one document value (so the first document value
specified determines the order; amongst groups of documents where that&#8217;s
the same, the second document value determines the order, and so on).</p>
<p>We&#8217;ll use this to change our sorted search above to order by year of
entry to the union and then by decreasing population.</p>
<p>The second parameter is a list of value names or slots.
If you want to reverse the value&#8217;s order, put it inside the <tt class="docutils literal"><span class="pre">{reverse,</span> <span class="pre">Slot}</span></tt>
tuple:</p>
<div class="highlight-python"><pre>$ ./bin/search_sorting2.escript priv/test_db/ranges2 State
 1: #041   Commonwealth of Pennsylva   17871212     12702379
 2: #044   State of New Jersey         17871218      8791894
 3: #050   State of Delaware           17871207       897934
 4: #042   State of New York           17880726     19378102
 5: #035   State of Georgia            17880102      9687653
 6: #039   Commonwealth of Virginia    17880625      8001024
 7: #047   Commonwealth of Massachus   17880206      6547629
 8: #051   State of Maryland           17880428      5773552
 9: #037   State of South Carolina     17880523      4625384
10: #049   State of Connecticut        17880109      3574097</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Sorting</a><ul>
<li><a class="reference internal" href="#sorting-by-value">Sorting by Value</a></li>
<li><a class="reference internal" href="#generated-sort-keys">Generated Sort Keys</a><ul>
<li><a class="reference internal" href="#sorting-by-multiple-values">Sorting by Multiple Values</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="facets.html"
                        title="previous chapter">Facets</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="collapsing.html"
                        title="next chapter">Collapsing of Search Results</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/howtos/sorting.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="collapsing.html" title="Collapsing of Search Results"
             >next</a> |</li>
        <li class="right" >
          <a href="facets.html" title="Facets"
             >previous</a> |</li>
        <li><a href="../index.html">Getting Started with Xapian 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >How To...</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Olly Betts, Richard Boulton, Justin Finkelstein, James Aylett.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>